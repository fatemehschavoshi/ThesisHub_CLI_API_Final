<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <!-- Meta & SEO -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="سامانه مدیریت پایان‌نامه‌ها - ThesisHub" />
  <meta name="theme-color" content="#0d6efd" />

  <title>{% block title %}ThesisHub | سامانه مدیریت پایان‌نامه{% endblock %}</title>

  <!-- Bootstrap 5 RTL (Core CSS) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" crossorigin="anonymous">

  <!-- App base styles -->
  <style>
    :root {
      --app-bg: #f7f7fb;
      --app-card-radius: 1rem;
    }
    body { background: var(--app-bg); }
    .card {
      border: 0;
      border-radius: var(--app-card-radius);
      box-shadow: 0 4px 18px rgba(0,0,0,.06);
    }
    .navbar-brand { font-weight: 700; letter-spacing: .2px; }
    .footer { color: #6c757d; }

    /* Dark mode */
    .dark body { background: #0f1115; }
    .dark .card { background: #161a22; color: #e6e6e6; box-shadow: 0 4px 18px rgba(0,0,0,.35); }
    .dark .navbar, .dark .dropdown-menu { background: #161a22 !important; }
    .dark .footer { color: #9aa4b2; }
  </style>

  {% block extra_css %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
  <!-- Global navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-body-tertiary shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="{{ url_for('home') }}">ThesisHub</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav" aria-controls="topNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="topNav">
        <!-- Primary nav -->
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('student_dashboard') }}">دانشجو</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('prof_dashboard') }}">استاد</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('judge_dashboard') }}">داور</a></li>
        </ul>

        <!-- Right side: auth shortcuts & theme toggle -->
        <div class="d-flex gap-2">
          <a class="btn btn-outline-primary btn-sm" href="{{ url_for('student_login_get') }}">ورود دانشجو</a>
          <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('prof_login_get') }}">ورود استاد</a>
          <a class="btn btn-outline-dark btn-sm" href="{{ url_for('judge_login_get') }}">ورود داور</a>
          <button id="themeToggle" class="btn btn-sm btn-light" type="button" title="تغییر پوسته">🌓</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Optional hero/header block -->
  {% block hero %}{% endblock %}

  <!-- Flash messages (Bootstrap alerts) -->
  <div class="container mt-3">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat, msg in messages %}
          <div class="alert alert-{{ cat }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <!-- Main content -->
  <main class="container my-4">
    {% block content %}
      {# فالبک برای وقتی که خود base مستقیم رندر می‌شود (مثل /) #}
      {% if content is defined %}{{ content|safe }}{% endif %}
    {% endblock %}
  </main>

  <!-- Footer -->
  <footer class="footer py-4 mt-5 border-top">
    <div class="container d-flex justify-content-between align-items-center">
      <small>© <span id="year"></span> ThesisHub — سامانه مدیریت پایان‌نامه</small>
      <small class="text-muted">نسخه نمایشی | CLI + Web</small>
    </div>
  </footer>

  <!-- Jinja macros (inline) -->
  {% macro pill(text, color='secondary') -%}
    <span class="badge text-bg-{{ color }}">{{ text }}</span>
  {%- endmacro %}

  {% macro alert(text, color='info') -%}
    <div class="alert alert-{{ color }} mb-0" role="alert">{{ text }}</div>
  {%- endmacro %}

  <!-- Bootstrap Bundle (JS) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  <!-- Theme toggle & footer year -->
  <script>
    (function() {
      // Footer year
      var y = document.getElementById('year');
      if (y) y.textContent = new Date().getFullYear();

      // Persisted theme handling
      const key = 'thesis.theme';
      const html = document.documentElement;
      const saved = localStorage.getItem(key);
      if (saved === 'dark') html.classList.add('dark');

      const btn = document.getElementById('themeToggle');
      if (btn) {
        btn.addEventListener('click', function() {
          html.classList.toggle('dark');
          localStorage.setItem(key, html.classList.contains('dark') ? 'dark' : 'light');
        });
      }
    })();
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>
